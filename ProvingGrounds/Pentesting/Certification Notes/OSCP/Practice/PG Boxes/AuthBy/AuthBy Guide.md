Nmap scan:

![e731e835217c3e7df869fc31e9398c5b.png](../../../../../../_resources/e731e835217c3e7df869fc31e9398c5b.png)

Try anonymous ftp login (anonymous/anonymous):
`ftp 192.168.112.46`
![53ebf54f61cd3caf655502d8e96c0400.png](../../../../../../_resources/53ebf54f61cd3caf655502d8e96c0400.png)

View files:

![a490dccba8ecbcc6c26d71ec20040c52.png](../../../../../../_resources/a490dccba8ecbcc6c26d71ec20040c52.png)

Find account names here:

![9ea17a4d5fc4b3d9b944237388204538.png](../../../../../../_resources/9ea17a4d5fc4b3d9b944237388204538.png)

Seeing offsec, admin, and anonymous accounts. Decided to try to log into offsec and admin accounts using ftp with no password and with anonymous password. Didn't work. Finally tried to log into admin with admin and it worked. However, another guide points to port 242 where a login screen is shown:

![a55c16776cf7dcacc596bfd2097a2af6.png](../../../../../../_resources/a55c16776cf7dcacc596bfd2097a2af6.png)

Brute force this login using Hydra:

`hydra -l admin -P /usr/share/wordlists/rockyou.txt 192.168.112.46 ftp â€“V -f`
Find password admin for account admin.

Now log into ftp using admin/admin to view more files:
![e63a399e2d32b53b37ed63b44d96fe7e.png](../../../../../../_resources/e63a399e2d32b53b37ed63b44d96fe7e.png)
See .htaccess and .htpasswd files:
![c829d226622d337e40e8b75d3eee281f.png](../../../../../../_resources/c829d226622d337e40e8b75d3eee281f.png)
Download files from ftp server:
`get [file_name]`

View files:
![baa06727a837fb3dfaad9f77f62a66c3.png](../../../../../../_resources/baa06727a837fb3dfaad9f77f62a66c3.png)
Translate:
![2439f1339a0eedecd1a80b08667fc0b6.png](../../../../../../_resources/2439f1339a0eedecd1a80b08667fc0b6.png)

View other file:
![fee8fbf6dd2f42ac07b9855e1eea0ab5.png](../../../../../../_resources/fee8fbf6dd2f42ac07b9855e1eea0ab5.png)

Use John to crack password with rockyou.txt:
`john --wordlist rockyou.txt .htpasswd`
![51602230b44f192765009aa59e541dc8.png](../../../../../../_resources/51602230b44f192765009aa59e541dc8.png)
Password for offsec account is elite. Use this to log into website at port 242:
![f54a28c17b374285f0dbee9a252b5271.png](../../../../../../_resources/f54a28c17b374285f0dbee9a252b5271.png)

Now I can upload a reverse shell onto the website. Site uses php as shown below, so find a reverse shell payload for Windows (AuthBy is a Windows box):
![1c0a32ceb8c5ee780bcb2a61b9cbb8dc.png](../../../../../../_resources/1c0a32ceb8c5ee780bcb2a61b9cbb8dc.png)
This windows reverse shell worked well:
https://github.com/Dhayalanb/windows-php-reverse-shell

Edit shellcode with attacker IP and port (used 8080). Upload onto the target using the ftp access with admin user:
`put shell.php`

Start netcat listener on port specified in shell.php (8080)
`nc -nlvp 8080`
Append shell.php to website from before (at port 242)
`http://192.168.112.46/shell.php`

This didn't work and I found out it's because of the tmp directory specified by default in that shell.php code. Modifying the $tmpdir variable to set it to C:\\wamp\\www fixes the issue
![182dc4eceef8df1da9e75908e6338ef5.png](../../../../../../_resources/182dc4eceef8df1da9e75908e6338ef5.png)

Make the change and rerun the exploit. Netcat returns a shell on the device:
![38743f30729c08458f8928ca31e017ed.png](../../../../../../_resources/38743f30729c08458f8928ca31e017ed.png)

Check logged in user:
![21b8d1231e2334de4b141b31acfeb14d.png](../../../../../../_resources/21b8d1231e2334de4b141b31acfeb14d.png)

Find user flag in user desktop directory.

Find out more info about the system:
`systeminfo`
![8ce82ce39f0c255ed85666ddc655a61d.png](../../../../../../_resources/8ce82ce39f0c255ed85666ddc655a61d.png)

Now looks for exploit for Server 2008 not using metasploit. Found https://github.com/SecWiki/windows-kernel-exploits/tree/master/CVE-2018-8120
This exploit allows a user on a system vulnerable to this exploit to start a new process as SYSTEM. This process can be used to to trigger a windows reverse shell payload.

Download the CVE-2018-8120 exploit. Save as exploit.exe.

Generate windows reverse shell payload named priv.exe using msfvenom:
![feb4fb1172fed0cf9d6ed70ececac2a6.png](../../../../../../_resources/feb4fb1172fed0cf9d6ed70ececac2a6.png)

Set up another listener specifying the same port from the windows msfvenom payload (using port found in nmap scan):
`nc -nlvp 3145`

Now use the exploit.exe to trigger the windows reverse shell payload:
![cad98fbdad05a7ee579b59415da7d3a2.png](../../../../../../_resources/cad98fbdad05a7ee579b59415da7d3a2.png)

Get a new shell back at the nc listener on port 3145 on the attack machine:
![f04f3984075820bdd7be054411a82614.png](../../../../../../_resources/f04f3984075820bdd7be054411a82614.png)

Find root flag in administrator desktop folder!
